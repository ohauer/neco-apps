# This file is automatically generated from a template. Please do not edit.
apiVersion: apps/v1
kind: StatefulSet
metadata:
  annotations:
    argocd.argoproj.io/sync-wave: "1"
  labels:
    app.kubernetes.io/component: node
    app.kubernetes.io/name: teleport
  name: node-set-cloud-platform
  namespace: teleport
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: node
      app.kubernetes.io/name: teleport
      teleport-node: set-cloud-platform
  serviceName: node-set-cloud-platform
  template:
    metadata:
      annotations:
        prometheus.io/port: "3020"
      labels:
        app.kubernetes.io/component: node
        app.kubernetes.io/name: teleport
        teleport-node: set-cloud-platform
    spec:
      automountServiceAccountToken: true
      containers:
        - args:
            - --roles=node
            - --labels=team=set-cloud-platform
            - --diag-addr=0.0.0.0:3020
          image: quay.io/cybozu/teleport-node
          livenessProbe:
            httpGet:
              path: /healthz
              port: 3020
            initialDelaySeconds: 5
            periodSeconds: 5
          name: node-set-cloud-platform
          ports:
            - containerPort: 3020
              name: metrics
          resources:
            requests:
              memory: 256Mi
          volumeMounts:
            - mountPath: /etc/teleport
              name: teleport-general-secret
              readOnly: true
            - mountPath: /var/lib/teleport
              name: teleport-storage
            - mountPath: /home/cybozu
              name: home-dir
      securityContext:
        runAsNonRoot: true
        runAsUser: 10000
      serviceAccountName: node-set-cloud-platform
      volumes:
        - name: teleport-general-secret
          secret:
            secretName: teleport-general-secret-20210310
        - emptyDir: {}
          name: teleport-storage
        - ephemeral:
            volumeClaimTemplate:
              spec:
                accessModes:
                  - ReadWriteOnce
                resources:
                  requests:
                    storage: 10Gi
                storageClassName: topolvm-provisioner
          name: home-dir
